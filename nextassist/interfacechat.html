<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat em Tempo Real</title>

    <script src="./chat.html"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f3f3f3;
        padding: 20px;
      }
      #chat {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      #mensagens {
        height: 300px;
        overflow-y: scroll;
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
      }
      .msg {
        padding: 5px;
        margin: 4px 0;
        border-radius: 5px;
        word-wrap: break-word; /* Garante que mensagens longas quebrem a linha */
      }
      .remetente {
        background-color: #d1ffd1; /* Verde claro */
        text-align: right;
        margin-left: 20%; /* Para destacar o bal√£o de fala */
      }
      .destinatario {
        background-color: #e1e1ff; /* Azul claro */
        text-align: left;
        margin-right: 20%; /* Para destacar o bal√£o de fala */
      }
      #form {
        display: flex;
        gap: 10px;
      }
      #form input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      #form button {
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }
      #form button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div id="chat">
      <h2>Chat em Tempo Real üí¨</h2>
      <div id="mensagens"></div>
      <form id="form">
        <input
          id="mensagem"
          placeholder="Digite sua mensagem..."
          autocomplete="off"
        />
        <button type="submit">Enviar</button>
      </form>
    </div>

    <script>
      // üëâ Altere a URL se seu servidor socket.io estiver em outra porta
      const socket = io("http://localhost:3000");

      const mensagensDiv = document.getElementById("mensagens");
      const form = document.getElementById("form");
      const input = document.getElementById("mensagem");

      // ID Fixo para este cliente
      const id_remetente = 1;
      // ID do destinat√°rio (na vida real, isso seria din√¢mico ou controlado por "salas")
      const id_destinatario = 2;

      // Recebe mensagens antigas (simulando carregamento inicial do DB)
      socket.on("mensagensAntigas", (msgs) => {
        msgs.forEach((m) =>
          // Verifica se o remetente da mensagem √© o pr√≥prio cliente (id_remetente === 1)
          adicionarMensagem(m.mensagem, m.id_remetente === id_remetente)
        );
      });

      // Recebe mensagens em tempo real
      socket.on("mensagem", (data) => {
        // Verifica se o remetente da mensagem recebida √© o pr√≥prio cliente (id_remetente === 1)
        adicionarMensagem(data.mensagem, data.id_remetente === id_remetente);
      });

      // Envia nova mensagem
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const msgTexto = input.value.trim();

        if (msgTexto !== "") {
          // Emite o evento 'mensagem' para o servidor
          socket.emit("mensagem", {
            id_remetente,
            id_destinatario,
            mensagem: msgTexto,
          });
          input.value = ""; // Limpa o campo de input
        }
      });

      // Fun√ß√£o para exibir mensagens na tela
      function adicionarMensagem(texto, souRemetente) {
        const div = document.createElement("div");
        // Adiciona classes para estilizar: 'msg' e 'remetente' ou 'destinatario'
        div.classList.add("msg", souRemetente ? "remetente" : "destinatario");
        div.textContent = texto;
        mensagensDiv.appendChild(div);

        // Mant√©m a caixa de mensagens sempre no final (scroll para baixo)
        mensagensDiv.scrollTop = mensagensDiv.scrollHeight;
      }
    </script>
  </body>
</html>
